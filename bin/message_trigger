#!/bin/bash
# Script: trigger
# Description: This is the trigger engine. It crawls for IRC flags and triggers
#              the corresponding mods or scripts.
#
# - Manages the handling of $flag
# - Initiates corresponding modules if a command is triggered
# - Inititates the background scripts

# create source_nick, flag, channel and message segments
source_nick=$(echo $hostmask | cut -d "!" -f 1)
flag=$(echo $header | cut -d " " -f 2)
chan=$(echo $header | cut -d " " -f 3)
msg=${body}

case $flag in
	JOIN)
		chan=$msg
		mkdir -p log/$server/ &> /dev/null
		mkdir -p var/run/$server/ &> /dev/null
		rm -rf var/run/$server/$chan &> /dev/null
		return
		;;
	PART)
		# since part messages don't come with the colon, we have to trick around a bit
		rm -f var/run/$server/$chan
		return
		;;
	QUIT)
		return
		;;
	INVITE)
		. mods/join $msg
		return
		;;
	MODE)
		# split into segments $mode and $mode_nick and process
		mode=$(echo $line | cut -d ' ' -f 4)
		mode_nick=$(echo $line | cut -d ' ' -f 5)
		. bin/message_triggers/mode
		;;
	KICK)
		# todo
		return
		;;
	PRIVMSG)
		. bin/message_triggers/privmsg
		return
		;;
esac
