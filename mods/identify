#!/bin/bash

declare -a FRIENDS

case $CHAN in
	\#*)	# Identifying in a channel is not so cool
	echo "WARNING: $SOURCE_NICK tried identifying in a channel!"
	answer "Don't identify in a channel, dumb-ass!"
	if [[ ! "$2" == "" ]]; then
		echo "CRITICAL: $SOURCE_NICK identified in a channel! Account [DISABLED]."
		answer "Great! Stating your password here was a very smart idea... idot!"
		answer "I am disabling your account, fool."
		echo "Yet to come..."
	fi
	;;
	
	*)		# If we are in a query, let's go
	# check if we already are authenticated
	for FRIEND in ${FRIENDS[*]}
	do
		if [[ "$FRIEND" == "$HOSTMASK" ]]; then
			answer "I allready know you."
			return
		fi
	done

	# walk through user file
	for USERLINE in $(cat etc/users)
	do
		# validate authentication
		if [[ "$(echo $USERLINE | cut -d: -f1)" == "$1" ]] && [[ "$(echo $USERLINE | cut -d: -f2)" == "$2" ]]; then
			FRIENDS[$1]="$HOSTMASK"
			answer ${FRIENDS[@]}
		fi
	done
esac

